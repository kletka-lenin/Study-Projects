#   Прогнозирование оттока клиентов оператора связи

В общем виде **цель** поставлена таким образом: оператор связи хочет прогнозировать отток клиентов, для того, чтобы предлагать специальные условия клиентам из "группы риска". 

Данные о клиентах содержатся в 4 таблицах (по 7 тыс. строк в каждой): это информация о договоре, некоторая социально-демографическая информация о клиенте, а также информация о подключении клиенту телефонных и интернет-услуг. Информация о договорах актуальна на 1 февраля 2020.

**Первичная задача** состоит в анализе данных и составлении плана работы на последующие этапы.
**После уточнения данных** была сформулирована основная задача работы: предложить модель бинарной классификации (планирует ли клиент покинуть компанию в ближайшее время или нет), которая дала бы качество свыше 0.85 по метрике ROC-AUC.

Для решения задач использовались библиотеки Pandas, Matplotlib, Numpy, Seaborn, Phik, Scikit-learn, LightGBM, XGBoost, CatBoost.

**Отчёт:**

**На первом этапе** был выполнен исследовательский анализ предоставленных данных. Он показал, что договор с оператором до 1 февраля 2020 года расторгли примерно 26% клиентов, причём значительная часть из них сделали это вскоре после заключения договора – и на пике притока клиентов во второй половине 2019 года. Как правило, ушедшие клиенты не заключали долгосрочные договоры с компанией, но ежемесячно платили в среднем больше, чем оставшиеся абоненты. Кроме того, более склонны разорвать договор были пенсионеры, а, например, с гендером клиентов их решение никак не было связано.

В целом, использование услуг компании было равномерно (доли пользователей не очень отличались от долей тех, кому отдельные услуги не были подключены), не наблюдается и значительных различий в социально-демографических характеристиках клиентов (за исключением малой доли пенсионеров).

**На втором этапе** была проведена подготовка признаков для обучения моделей классификации:
1. Таблицы были объединены по `CustomerID`.
2. Был создан столбец `has_quit`, содержащий целевой признак. В целом, дисбаланс классов присутствует, но не является большой проблемой (классы распределены примерно 1:3).
3. Из данных о дате заключения контракта и дате его расторжения (или принятого за финальную дату 01.02.2020) был создан столбец, содержащий информацию о количестве дней, в течение которых абонент являлся клиентом компании.
4. Были удалены столбцы 'customerID', 'EndDate', 'BeginDate', 'TotalCharges', 'gender', которые не нужны для обучения моделей. Решение о том, какие признаки оставить в датасете, было принято по итогам эксперимента.
5. Пропуски в данных находились в столбцах о подключении отдельных услуг – они были заполнены на значение `No`, что соответствует смыслу.
6. Целевой признак был отделён от остальных, проведено исследование признаков на внутреннюю корреляцию с помощью коэффициента PhiK.
7. Данные были разделены на обучающую и тестовую выборки, построен пайплайн для обработки данных.

В результате решено было оставить для обучения моделей столбцы: 'Type', 'PaperlessBilling', 'PaymentMethod', 'MonthlyCharges','SeniorCitizen', 'Partner', 'Dependents', 'InternetService', 'OnlineSecurity', 'OnlineBackup', 'DeviceProtection', 'TechSupport', 'StreamingTV', 'StreamingMovies', 'MultipleLines', 'Duration'.

Далее проводилось обучение, подбор гиперпараметров и кросс-валидация на 5 моделях:
1. Логистическая регрессия,
2. Случайный лес,
3. XGBoost,
4. LightGBM,
5. CatBoost.

Во всех случаях отбиралась лучшая попытка по метрике AUC-ROC.
**Наилучшее качество** было получено моделью CatBoostClassifier с параметрами: learning rate = 0.4, num_iterations = 140, depth = 4. 

На тестовой выборке эта модель показала качество по метрике AUC-ROC 0.93. Модель дала 1213 истинно положительных и 288 истинно негативных ответов (из 1761 наблюдения в тестовой выборке). Наиболее важные признаки – продолжительность сотрудничества клиента и оператора, сумма ежемесячного платежа и тип контракта.

**В прикладном плане** (для задачи компании) это означает, что наибольшие усилия целесообразно прикладывать для того, чтобы повысить лояльность новых клиентов, оправдать их ожидания (в частности, от новых предложений) и сподвигнуть их к заключению долгосрочного договора.
