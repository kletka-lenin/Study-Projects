# Определение стоимости автомобилей

Сервис по продаже автомобилей с пробегом «Не бит, не крашен» разрабатывает приложение для привлечения новых клиентов. В нём можно быстро узнать рыночную стоимость своего автомобиля. В вашем распоряжении исторические данные: технические характеристики, комплектации и цены автомобилей. Вам нужно построить модель для определения стоимости. 

Заказчику важны:

- качество предсказания;
- скорость предсказания;
- время обучения.

**Цель исследования - построить модель для определения рыночной стоимости автомобиля по набору параметров.** Так как модель должна работать в приложении, то ключевыми параметрами являются качество предсказания, скорость предсказания и время обучения.

Таким образом, **задачи** состоят в следующем:
- загрузить, изучить и подготовить данные: заполнить пропущенные значения, обработать аномалии, удалить неинформативные признаки, подготовить выборки для обучения моделей.
- обучить модели: одну LightGBM, как минимум, одну - не использующую алгоритм градиентного бустинга. Попробовать различные гиперпараметры для разных моделей.
- проанализировать время обучения, время предсказания и качество моделей (по метрике RMSE, значение которой должно быть менее 2500). Выбрать лучную модель в соответствии с целью исследования.

Датасет включает 16 признаков и 354 тыс. строк.

Для выполнения задач использовались библиотеки Pandas, Numpy, Seaborn, Scikit-learn, LightGBM, CatBoost.

**Выводы:**

Обработка количественных признаков состояла в следующем:

* Удалили из таблицы данные, где была указана слишком низкая стоимость автомобилей.
* Удалили аномалии по году выпуска автомобиля – машины, у которых указан год регистрации раньше, чем 1910, а также автомобили, зарегистрированные после 2022 года.
* Удалили автомобили с заявленной мощностью более 500 л.с. и менее 20 л.с.

Обработка качественных признаков свелась к заполнению пропущенных значений, которых в представленных данных оказалось довольно много. Всякий раз при этом принималось во внимание, какой группе соответствует группа с отсутствующими значениями по медианной цене и другим параметрам. Практически во всех случаях эта группа обозначалась отдельно – однако в столбце `VehicleType` решено было присоединить её к группе small, основываясь на данных о медианной стоимости.

Было также проведено исследование признаков на предмет мультиколлинеарности. Оно не выявило значимых зависимостей между признаками (за исключением корреляций с целевым признаком мощности автомобиля и года его регистрации). После этого целевой признак был отделён, выборки разделены на тренировочную, валидационную и тестовую в соотношении 3:1:1.

Заданное значение RMSE, как представляется, весьма велико – 2500 при медианной стоимости автомобиля из выборки около 2700. Следовательно, желательно было и уменьшить RMSE, и добиться оптимальной скорости работы модели. 

В исследовании участвовали три модели: линейная регрессия и градиентные бустинги LightGBM и CatBoost. **Линейная регрессия** наиболее «требовательна» к входящим данным – для её работы все категориальные признаки были обработаны техникой OHE, что привело к значительному росту количества признаков. В результате модель работала не «моментально». При этом RMSE составила более 3000, что примерно равно медианному значению цены. Таким образом, линейная регрессия не рассматривалась как подходящая модель для решения задачи.

Два градиентных бустинга показали высокое качество предсказаний, хотя и работали медленнее. **Градиентный бустинг LightGBM**. С помощью подбора параметров удалось улучшить качество предсказаний этой модели до RMSE равной 1546 на валидационной выборке, при этом время обучения и предсказания составило менее 3 секунд. На тестовой выборке модель сделала предсказание за 90 миллисекунд с RMSE 1606.

**Градиентный бустинг CatBoost** наименее требователен к входящим данным. Однако время обучения у этой модели оказалось значительно большим, чем у LightGBM – даже с учётом того, что количество итераций было на порядок меньшим. 

**Результаты тестирования можно признать неоднозначными**. Различия в качестве работы двух градиентных бустингов незначительны, время обучения у LightGBM выигрывает. Однако большим преимуществом CatBoost в текущей ситуации является возможность работать с категориальными переменными без дополнительного кодирования. Это ускоряет обработку данных. Кроме того, с приложением работают пользователи, которые не всегда располагают полными данными о своём автомобиле (об этом говорит большое количество пропусков) – следовательно, могут появляться новые категории.
